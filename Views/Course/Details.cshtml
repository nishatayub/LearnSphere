@model LearnSphere.Models.Course

@{
    ViewData["Title"] = Model.Title;
    var isEnrolled = ViewBag.IsEnrolled ?? false;
}

<div class="container">
    <!-- Course Header -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Index">Courses</a></li>
                    <li class="breadcrumb-item active">@Model.Title</li>
                </ol>
            </nav>

            <h1 class="fw-bold mb-3">@Model.Title</h1>
            <p class="lead">@Model.Description</p>

            <div class="d-flex gap-3 align-items-center mb-3">
                <span class="badge bg-info fs-6">@Model.Difficulty</span>
                @if (Model.AverageRating > 0)
                {
                    <span><i class="bi bi-star-fill text-warning"></i> @Model.AverageRating.Value.ToString("0.0")</span>
                }
                <span><i class="bi bi-people"></i> @Model.TotalEnrollments students</span>
                <span><i class="bi bi-clock"></i> Created @Model.CreatedAt.ToShortDateString()</span>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow">
                @if (!string.IsNullOrEmpty(Model.ThumbnailUrl))
                {
                    <img src="@Model.ThumbnailUrl" class="card-img-top" alt="@Model.Title">
                }
                <div class="card-body text-center">
                    <h3 class="text-primary fw-bold mb-3">
                        <text>FREE</text>
                    </h3>

                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        @if (isEnrolled)
                        {
                            <a asp-controller="Course" asp-action="MyEnrollments" class="btn btn-success w-100 mb-2">
                                <i class="bi bi-check-circle"></i> Enrolled - Go to My Learning
                            </a>
                        }
                        else if (User.IsInRole("Student"))
                        {
                            <form asp-action="Enroll" asp-route-id="@Model.Id" method="post">
                                <button type="submit" class="btn btn-primary w-100 mb-2">
                                    <i class="bi bi-plus-circle"></i> Enroll Now
                                </button>
                            </form>
                        }
                        else
                        {
                            <p class="text-muted">Only students can enroll</p>
                        }
                    }
                    else
                    {
                        <a asp-controller="Account" asp-action="Login" class="btn btn-primary w-100 mb-2">
                            Sign in to Enroll
                        </a>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Course Content -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="bi bi-list-ul"></i> Course Content</h4>
                </div>
                <div class="card-body">
                    @if (Model.Versions != null && Model.Versions.Any())
                    {
                        var activeVersion = Model.Versions.FirstOrDefault(v => v.IsActive);
                        if (activeVersion?.Lessons != null && activeVersion.Lessons.Any())
                        {
                            <div class="list-group">
                                @foreach (var lesson in activeVersion.Lessons.OrderBy(l => l.OrderIndex))
                                {
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">@lesson.OrderIndex. @lesson.Title</h6>
                                            <small class="text-muted">@lesson.ContentType</small>
                                        </div>
                                        <div class="text-end">
                                            <small class="text-muted">
                                                <i class="bi bi-clock"></i> @lesson.DurationMinutes min
                                            </small>
                                            @if (lesson.IsFree)
                                            {
                                                <span class="badge bg-success ms-2">Free Preview</span>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p class="text-muted">Course content coming soon...</p>
                        }
                    }
                    else
                    {
                        <p class="text-muted">Course content coming soon...</p>
                    }
                </div>
            </div>

            <!-- Instructor Info -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-person"></i> Instructor</h5>
                </div>
                <div class="card-body">
                    <p><strong>@Model.Instructor?.FirstName @Model.Instructor?.LastName</strong></p>
                    <p class="text-muted">@Model.Instructor?.Email</p>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0">Course Details</h6>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-trophy text-primary"></i> Difficulty: <strong>@Model.Difficulty</strong></li>
                        <li class="mb-2"><i class="bi bi-people text-primary"></i> Enrolled: <strong>@Model.TotalEnrollments students</strong></li>
                        <li class="mb-2"><i class="bi bi-calendar text-primary"></i> Created: <strong>@Model.CreatedAt.ToString("MMM dd, yyyy")</strong></li>
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <li class="mb-2"><i class="bi bi-arrow-repeat text-primary"></i> Updated: <strong>@Model.UpdatedAt.Value.ToString("MMM dd, yyyy")</strong></li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
